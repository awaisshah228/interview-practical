{
  "id": "json_stringify",
  "title": "JS JSON.stringify()",
  "group": "JS JSON",
  "content": [
    { "type": "h1", "text": "JavaScript JSON.stringify()" },
    { "type": "p", "text": "The JSON.stringify() method converts a JavaScript value (object, array, or primitive) into a JSON string. It is used to serialize data for storage or transmission to a server." },

    { "type": "h2", "text": "Basic JSON.stringify()" },
    { "type": "p", "text": "Pass any JavaScript value to JSON.stringify() and it returns the corresponding JSON string representation." },
    { "type": "example", "title": "Stringify Basics", "code": [
      "const obj = { name: 'Alice', age: 30, active: true };",
      "const json = JSON.stringify(obj);",
      "console.log(json);",
      "console.log(typeof json);",
      "",
      "// Arrays",
      "const arr = [1, 'two', true, null];",
      "console.log(JSON.stringify(arr));",
      "",
      "// Primitives",
      "console.log(JSON.stringify(42));",
      "console.log(JSON.stringify('hello'));",
      "console.log(JSON.stringify(true));",
      "console.log(JSON.stringify(null));"
    ]},

    { "type": "h2", "text": "The Replacer Function" },
    { "type": "p", "text": "The second parameter of JSON.stringify() is the replacer. It can be a function that transforms values during serialization, or an array that specifies which properties to include." },
    { "type": "example", "title": "Replacer as a Function", "code": [
      "const user = {",
      "  name: 'Alice',",
      "  password: 'secret123',",
      "  age: 30,",
      "  email: 'alice@example.com'",
      "};",
      "",
      "// Replacer function: filter out sensitive data",
      "const safe = JSON.stringify(user, function(key, value) {",
      "  if (key === 'password') {",
      "    return undefined;  // Omit this property",
      "  }",
      "  return value;",
      "});",
      "console.log('Filtered: ' + safe);",
      "",
      "// Replacer as array: include only specified keys",
      "const partial = JSON.stringify(user, ['name', 'email']);",
      "console.log('Partial: ' + partial);"
    ]},

    { "type": "h2", "text": "The Space Parameter (Pretty Print)" },
    { "type": "p", "text": "The third parameter controls indentation for readability. You can pass a number (spaces) or a string (custom indentation)." },
    { "type": "example", "title": "Pretty Printing JSON", "code": [
      "const data = {",
      "  name: 'Product',",
      "  price: 29.99,",
      "  tags: ['sale', 'featured'],",
      "  details: {",
      "    weight: '1kg',",
      "    color: 'blue'",
      "  }",
      "};",
      "",
      "// Compact (default)",
      "console.log('Compact:');",
      "console.log(JSON.stringify(data));",
      "",
      "// Pretty with 2 spaces",
      "console.log('\\nPretty (2 spaces):');",
      "console.log(JSON.stringify(data, null, 2));",
      "",
      "// Pretty with tab",
      "console.log('\\nPretty (tab):');",
      "console.log(JSON.stringify(data, null, '\\t'));"
    ]},

    { "type": "h2", "text": "The toJSON() Method" },
    { "type": "p", "text": "If an object has a toJSON() method, JSON.stringify() calls it and uses the return value instead of the object itself. This lets you customize how an object is serialized." },
    { "type": "example", "title": "Custom toJSON()", "code": [
      "class Temperature {",
      "  constructor(celsius) {",
      "    this.celsius = celsius;",
      "    this.fahrenheit = celsius * 9/5 + 32;",
      "  }",
      "",
      "  toJSON() {",
      "    return {",
      "      value: this.celsius,",
      "      unit: 'C',",
      "      display: this.celsius + 'Â°C'",
      "    };",
      "  }",
      "}",
      "",
      "const temp = new Temperature(100);",
      "console.log(JSON.stringify(temp, null, 2));",
      "",
      "// Date objects have built-in toJSON()",
      "const date = new Date('2024-06-15');",
      "console.log(JSON.stringify({ date: date }));"
    ]},

    { "type": "h2", "text": "Handling undefined, Functions, and Symbols" },
    { "type": "p", "text": "JSON.stringify() handles certain JavaScript values specially: undefined, functions, and symbols are omitted from objects or converted to null in arrays." },
    { "type": "example", "title": "Special Values Behavior", "code": [
      "const obj = {",
      "  name: 'Test',",
      "  value: undefined,",
      "  method: function() { return 1; },",
      "  symbol: Symbol('id'),",
      "  valid: 'yes'",
      "};",
      "",
      "// undefined, functions, symbols are OMITTED from objects",
      "console.log(JSON.stringify(obj));",
      "",
      "// In arrays, they become null",
      "const arr = [1, undefined, function(){}, Symbol('x'), 'hello'];",
      "console.log(JSON.stringify(arr));",
      "",
      "// Standalone undefined/function returns undefined (not a string)",
      "console.log(JSON.stringify(undefined));",
      "console.log(typeof JSON.stringify(undefined));"
    ]},

    { "type": "h2", "text": "Circular References" },
    { "type": "p", "text": "JSON.stringify() throws a TypeError if the object contains circular references (an object that references itself). You need to handle this manually or use a replacer." },
    { "type": "example", "title": "Handling Circular References", "code": [
      "// Circular reference example",
      "const obj = { name: 'Circular' };",
      "// obj.self = obj;  // This would cause TypeError",
      "",
      "// Safe stringify that handles circular references",
      "function safeStringify(obj) {",
      "  const seen = new Set();",
      "  return JSON.stringify(obj, function(key, value) {",
      "    if (typeof value === 'object' && value !== null) {",
      "      if (seen.has(value)) {",
      "        return '[Circular Reference]';",
      "      }",
      "      seen.add(value);",
      "    }",
      "    return value;",
      "  }, 2);",
      "}",
      "",
      "const a = { name: 'A' };",
      "const b = { name: 'B', ref: a };",
      "a.ref = b;  // Circular!",
      "",
      "console.log(safeStringify(a));"
    ]},

    { "type": "table", "rows": [
      ["Value Type", "In Object", "In Array", "Standalone"],
      ["undefined", "Omitted", "null", "undefined (not string)"],
      ["Function", "Omitted", "null", "undefined (not string)"],
      ["Symbol", "Omitted", "null", "undefined (not string)"],
      ["NaN", "null", "null", "null"],
      ["Infinity", "null", "null", "null"],
      ["Date", "toJSON() string", "toJSON() string", "toJSON() string"]
    ]},

    { "type": "note", "text": "JSON.stringify() is commonly used to deep clone objects (JSON.parse(JSON.stringify(obj))), but this approach loses functions, undefined values, symbols, and Date objects (converted to strings). For proper deep cloning, use structuredClone() instead." },

    { "type": "exercise", "question": "What happens when JSON.stringify() encounters a function in an object?", "options": ["It converts the function to a string", "It throws an error", "It omits the property entirely", "It converts it to null"], "answer": 2 }
  ]
}
